# Руководство по миграции

## Переход на новую модульную структуру

### Что изменилось

1. **Структура проекта**: Код разделен на модули по функциональности
2. **Dependency Injection**: Все зависимости управляются через DI контейнер
3. **Репозитории**: Доступ к БД через репозитории вместо прямых запросов
4. **Сервисы**: Бизнес-логика вынесена в сервисы
5. **Кеширование**: Добавлено многоуровневое кеширование (LRU + Redis)

### Шаги миграции

1. **Скопируйте старые файлы**:
   - `portalsmp.py` → оставьте в корне
   - `tonnelmp_wrapper.py` → оставьте в корне
   - `mrktmp_wrapper.py` → оставьте в корне
   - `config.py` → можно удалить (используется `src/bot/config.py`)

2. **Обновите .env файл**:
   - Добавьте новые переменные из `.env.example`

3. **Запустите миграцию БД** (если нужно):
   - Схема БД создается автоматически при первом запуске

4. **Запустите бота**:
   ```bash
   python -m src.bot.main
   ```

### Недостающие компоненты

Следующие компоненты нужно перенести из старого `bot.py`:

1. **Полный парсинг подарков** (`get_all_gift_names_from_marketplace`) → `src/bot/services/parser.py`
2. **Обработка новых подарков** (`process_new_gift_monitoring`) → `src/bot/tasks/workers.py`
3. **FSM состояния** → `src/bot/handlers/messages/`
4. **Форматирование сообщений** → `src/bot/utils/formatters.py`

### Важные замечания

- Старый `bot.py` можно оставить для справки, но не использовать
- Все импорты обновлены для новой структуры
- Проверьте все пути к файлам в конфигурации


