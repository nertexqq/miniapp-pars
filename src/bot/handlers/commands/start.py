"""–ö–æ–º–∞–Ω–¥–∞ /start"""

from aiogram import types
from aiogram.filters import Command
from ...di import container
from ...repositories.user_repo import UserRepository
from ...models.entities import User
from ...keyboards.builders import get_main_menu_keyboard


async def cmd_start(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user_repo = UserRepository(await container.init_db_pool())
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user = User(
        user_id=message.from_user.id,
        username=message.from_user.username,
        first_name=message.from_user.first_name,
        last_name=message.from_user.last_name,
        notifications_enabled=False
    )
    await user_repo.create_or_update(user)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    keyboard = await get_main_menu_keyboard(message.from_user.id)
    await message.answer(
        "ü§ñ –ë–æ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–∞—Ä–∫–æ–≤\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=keyboard
    )


